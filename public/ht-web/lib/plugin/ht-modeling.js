!function(f,O,h){"use strict";function V(C,F){this.position=C,this.$22n=F}var p="ht",U=f[p],_=null,y=Math,j=y.PI,z=y.cos,m=y.sin,K=y.abs,c=y.max,E=y.sqrt,W=1e-5,$=U.Default,k=$.def,I=$.startAnim,n=$.createMatrix,J=$.transformVec,H=$.getInternal(),s=H.addMethod,L=H.superCall,T=H.toPointsArray,C=H.createNormals,g=H.toFloatArray,r=H.glMV,e=(H.glPop,U.graph3d.Graph3dView,U.Math),R=e.Vector3,d=e.Matrix4,w=e.Euler,v=(e.Quaternion,H.batchShape),D=H.createNodeMatrix,M=H.getFaceInfo,B=H.transformAppend,N=H.drawFaceInfo,i=H.createAnim,a=H.cube(),Z=a.is,S=a.vs,G=a.uv,l=H.ui(),F=U.Node,b=U.Shape,Q="h",x="v",t="front",X="back",u="left",A="right",Y="top",P="bottom",o="dw.expanded",q=".expanded",om="dw.angle",Zb=".angle",rq=function(z,e,w){k(p+"."+z,e,w)},Tk=function(L,H,Z){Z?L.push(H.x,H.y):L.push(H.x,H.y,H.z)},zf=function(){var r=new U.Math.Vector3,g=new U.Math.Vector3,A=new U.Math.Vector3;return function(w,J,n,h,c){if(r.copy(J.$24n),g.copy(n.$24n),A.copy(h.$24n),!(A.equals(r)||g.equals(r)||g.equals(A))){if(!J.$22n||!n.$22n||!h.$22n){var _=g.sub(r).cross(A.sub(r)).normalize().multiplyScalar(1).toArray();J.$22n||(J.$22n=new ao(_)),n.$22n||(n.$22n=new ao(_)),h.$22n||(h.$22n=new ao(_))}w.push(new Cr([J,n,h],c))}}}(),vm=function(J,i,K,o){var w,B,b,k,q=0,n=[];if(o)for(w=o.length;w>q;q+=3)B=o[q],b=o[q+1],k=o[q+2],zf(n,new Jd([i[3*B],i[3*B+1],i[3*B+2]],null,K?[K[2*B],K[2*B+1],0]:_),new Jd([i[3*b],i[3*b+1],i[3*b+2]],null,K?[K[2*b],K[2*b+1],0]:_),new Jd([i[3*k],i[3*k+1],i[3*k+2]],null,K?[K[2*k],K[2*k+1],0]:_),J);else for(w=i.length/3;w>q;q+=3)B=q,b=q+1,k=q+2,zf(n,new Jd([i[3*B],i[3*B+1],i[3*B+2]],null,K?[K[2*B],K[2*B+1],0]:_),new Jd([i[3*b],i[3*b+1],i[3*b+2]],null,K?[K[2*b],K[2*b+1],0]:_),new Jd([i[3*k],i[3*k+1],i[3*k+2]],null,K?[K[2*k],K[2*k+1],0]:_),J);return n},nq=[u,t,A,X,Y,P],dh=["",Y,P],Kj=nq.concat("csg"),Mc=[0,6,12,18,24,30],Wn=function($,Q,j){var U=D($),h=[];$.appendAnchorMatrix3d(U);var f,B=Q?Q.getData3dUI($):null;if(B&&B.s("shape3d")&&!B.s("csg.cull.box")&&(f=B.shapeModel,B.shapeModel||(f=H.getShapeModel(B,B.s("shape3d"))),f))for(var l=H.createNormalMatrix(U),s=0,C=dh.length;C>s;s++){var W=dh[s],e=W.length?W+"_":W,F=f[e+"vs"],w=f[e+"uv"],t=f[e+"is"],m=f[e+"ns"];if(F&&F.length)for(var E,a,N,T=0,A=t?t.length:F.length/3;A>T;T+=3)t?(E=t[T],a=t[T+1],N=t[T+2]):(E=T,a=T+1,N=T+2),zf(h,new Jd(J([F[3*E],F[3*E+1],F[3*E+2]],U),m?J([m[3*E],m[3*E+1],m[3*E+2]],l):null,[w[2*E],w[2*E+1],0]),new Jd(J([F[3*a],F[3*a+1],F[3*a+2]],U),m?J([m[3*a],m[3*a+1],m[3*a+2]],l):null,[w[2*a],w[2*a+1],0]),new Jd(J([F[3*N],F[3*N+1],F[3*N+2]],U),m?J([m[3*N],m[3*N+1],m[3*N+2]],l):null,[w[2*N],w[2*N+1],0]),$)}if(!f)for(var s=0;6>s;s++)for(var W=nq[s],o=Mc[s],w=j?Q.getFaceUv($,W):_,c=j?Q.getFaceUvScale($,W):_,L=j?Q.getFaceUvOffset($,W):_,u=0;2>u;u++){var V,i,b,k=Z[o+3*u],x=Z[o+3*u+1],R=Z[o+3*u+2];if(j){if(w){var X=8*s;V=[w[2*k-X],w[2*k+1-X],0],i=[w[2*x-X],w[2*x+1-X],0],b=[w[2*R-X],w[2*R+1-X],0]}else V=[G[2*k],G[2*k+1],0],i=[G[2*x],G[2*x+1],0],b=[G[2*R],G[2*R+1],0];c&&(V[0]*=c[0],V[1]*=c[1],i[0]*=c[0],i[1]*=c[1],b[0]*=c[0],b[1]*=c[1]),L&&(V[0]+=L[0],V[1]+=L[1],i[0]+=L[0],i[1]+=L[1],b[0]+=L[0],b[1]+=L[1])}zf(h,new Jd(J([S[3*k],S[3*k+1],S[3*k+2]],U),null,V),new Jd(J([S[3*x],S[3*x+1],S[3*x+2]],U),null,i),new Jd(J([S[3*R],S[3*R+1],S[3*R+2]],U),null,b),$)}return Og.$15n(h)},Pm=function(F,J,V){var Z,c=F.data.getAttaches();if(c&&c.each(function(G){G instanceof yi&&G.s("attach.operation")&&(Z||(Z=[]),Z.push(G))}),Z){var K;nq.forEach(function(D){var i=vm(D,F[D].vs,F[D].tuv);K=K?K.concat(i):i}),K=Og.$15n(K),Z.forEach(function(H){var S=H.s("attach.operation");K[S]&&(K=K[S](Wn(H,F.gv,F.csg.tuv)))}),nq.forEach(function(k){k=F[k],k.vs=[],k.ns=[],k.tuv&&(k.tuv=[])}),F.csg&&!F.csg.ns&&(F.csg.ns=[]);var I=[];if(K.$19n().forEach(function(e){var $,g=e.$10n;if(g instanceof yi){if(g.s("attach.cull"))return;$=g.s("csg.cull.color"),$&&($=H.toColorArray($)),g="csg"}for(var m=F[g],c=m.vs,o=m.ns,s=m.tuv,Z=e.$9n,d=2;d<Z.length;d++)if(Tk(c,Z[0].$24n),Tk(c,Z[d-1].$24n),Tk(c,Z[d].$24n),o&&(Tk(o,Z[0].$22n),Tk(o,Z[d-1].$22n),Tk(o,Z[d].$22n)),s&&(Tk(s,Z[0].uv,!0),Tk(s,Z[d-1].uv,!0),Tk(s,Z[d].uv,!0)),$)for(var q=4*(c.length/3),u=0;3>u;u++)I[--q]=$[3],I[--q]=$[2],I[--q]=$[1],I[--q]=$[0]}),I.length){for(var b=H.toColorArray(F.csg.color),U=0,P=4*(F.csg.vs.length/3);P>U;U+=4)I[U]==h&&(I[U]=b[0],I[U+1]=b[1],I[U+2]=b[2],I[U+3]=b[3]);F.csg.cs=I}}Kj.forEach(function(M){var u=F[M];u.visible&&u.vs.length?(u.ns&&u.ns.length?g(u,"ns"):u.ns=C(u.vs),g(u,"vs"),g(u,"tuv"),u.cs&&g(u,"cs")):delete F[M]}),J&&(v(F,_,J,_,V),F.clear())};s($,{createFrameModel:function(I,N,e,J){I=I==_?.07:I,N=N==_?I:N,e=e==_?I:e,J=J?J:{};var a=J.top,H=J.bottom,q=J.left,E=J.right,y=J.front,t=J.back,P=[],A=[];return y===!0?(P.push(-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5),A.push(0,0,0,1,1,1,1,1,1,0,0,0)):y===!1||(P.push(-.5,.5,.5,-.5,-.5,.5,-.5+I,-.5,.5,-.5+I,-.5,.5,-.5+I,.5,.5,-.5,.5,.5,.5-I,.5,.5,.5-I,-.5,.5,.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5-I,.5,.5,-.5+I,.5,.5,-.5+I,.5-N,.5,.5-I,.5-N,.5,.5-I,.5-N,.5,.5-I,.5,.5,-.5+I,.5,.5,-.5+I,-.5+N,.5,-.5+I,-.5,.5,.5-I,-.5,.5,.5-I,-.5,.5,.5-I,-.5+N,.5,-.5+I,-.5+N,.5),A.push(0,0,0,1,I,1,I,1,I,0,0,0,1-I,0,1-I,1,1,1,1,1,1,0,1-I,0,I,0,I,N,1-I,N,1-I,N,1-I,0,I,0,I,1-N,I,1,1-I,1,1-I,1,1-I,1-N,I,1-N)),t===!0?(P.push(-.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5),A.push(1,0,0,1,1,1,0,1,1,0,0,0)):t===!1||(P.push(-.5,.5,-.5,-.5+I,-.5,-.5,-.5,-.5,-.5,-.5+I,-.5,-.5,-.5,.5,-.5,-.5+I,.5,-.5,.5-I,.5,-.5,.5,-.5,-.5,.5-I,-.5,-.5,.5,-.5,-.5,.5-I,.5,-.5,.5,.5,-.5,-.5+I,.5,-.5,.5-I,.5-N,-.5,-.5+I,.5-N,-.5,.5-I,.5-N,-.5,-.5+I,.5,-.5,.5-I,.5,-.5,-.5+I,-.5+N,-.5,.5-I,-.5,-.5,-.5+I,-.5,-.5,.5-I,-.5,-.5,-.5+I,-.5+N,-.5,.5-I,-.5+N,-.5),A.push(1,0,1-I,1,1,1,1-I,1,1,0,1-I,0,I,0,0,1,I,1,0,1,I,0,0,0,1-I,0,I,N,1-I,N,I,N,1-I,0,I,0,1-I,1-N,I,1,1-I,1,I,1,1-I,1-N,I,1-N)),q===!0?(P.push(-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5),A.push(0,0,0,1,1,1,1,1,1,0,0,0)):q===!1||(P.push(-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5+e,-.5,-.5,-.5+e,-.5,.5,-.5+e,-.5,.5,-.5,-.5,.5,.5-e,-.5,-.5,.5-e,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,.5-e,-.5,.5,-.5+e,-.5,.5-N,-.5+e,-.5,.5-N,.5-e,-.5,.5-N,.5-e,-.5,.5,.5-e,-.5,.5,-.5+e,-.5,-.5+N,-.5+e,-.5,-.5,-.5+e,-.5,-.5,.5-e,-.5,-.5,.5-e,-.5,-.5+N,.5-e,-.5,-.5+N,-.5+e),A.push(0,0,0,1,e,1,e,1,e,0,0,0,1-e,0,1-e,1,1,1,1,1,1,0,1-e,0,e,0,e,N,1-e,N,1-e,N,1-e,0,e,0,e,1-N,e,1,1-e,1,1-e,1,1-e,1-N,e,1-N)),E===!0?(P.push(.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,.5,.5,.5,-.5,.5,.5,.5),A.push(1,0,0,1,1,1,0,1,1,0,0,0)):E===!1||(P.push(.5,.5,-.5,.5,-.5,-.5+e,.5,-.5,-.5,.5,-.5,-.5+e,.5,.5,-.5,.5,.5,-.5+e,.5,.5,.5-e,.5,-.5,.5,.5,-.5,.5-e,.5,-.5,.5,.5,.5,.5-e,.5,.5,.5,.5,.5,-.5+e,.5,.5-N,.5-e,.5,.5-N,-.5+e,.5,.5-N,.5-e,.5,.5,-.5+e,.5,.5,.5-e,.5,-.5+N,-.5+e,.5,-.5,.5-e,.5,-.5,-.5+e,.5,-.5,.5-e,.5,-.5+N,-.5+e,.5,-.5+N,.5-e),A.push(1,0,1-e,1,1,1,1-e,1,1,0,1-e,0,e,0,0,1,e,1,0,1,e,0,0,0,1-e,0,e,N,1-e,N,e,N,1-e,0,e,0,1-e,1-N,e,1,1-e,1,e,1,1-e,1-N,e,1-N)),a===!0?(P.push(.5,.5,.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5),A.push(1,1,1,0,0,0,0,0,0,1,1,1)):a===!1||(P.push(.5,.5,.5,.5,.5,-.5,.5-I,.5,-.5,.5-I,.5,-.5,.5-I,.5,.5,.5,.5,.5,-.5+I,.5,.5,-.5+I,.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5+I,.5,.5,.5-I,.5,.5,.5-I,.5,.5-e,-.5+I,.5,.5-e,-.5+I,.5,.5-e,-.5+I,.5,.5,.5-I,.5,.5,.5-I,.5,-.5+e,.5-I,.5,-.5,-.5+I,.5,-.5,-.5+I,.5,-.5,-.5+I,.5,-.5+e,.5-I,.5,-.5+e),A.push(1,1,1,0,1-I,0,1-I,0,1-I,1,1,1,I,1,I,0,0,0,0,0,0,1,I,1,1-I,1,1-I,1-e,I,1-e,I,1-e,I,1,1-I,1,1-I,e,1-I,0,I,0,I,0,I,e,1-I,e)),H===!0?(P.push(.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5),A.push(1,0,0,1,1,1,0,1,1,0,0,0)):H===!1||(P.push(.5,-.5,.5,.5-I,-.5,-.5,.5,-.5,-.5,.5-I,-.5,-.5,.5,-.5,.5,.5-I,-.5,.5,-.5+I,-.5,.5,-.5,-.5,-.5,-.5+I,-.5,-.5,-.5,-.5,-.5,-.5+I,-.5,.5,-.5,-.5,.5,.5-I,-.5,.5,-.5+I,-.5,.5-e,.5-I,-.5,.5-e,-.5+I,-.5,.5-e,.5-I,-.5,.5,-.5+I,-.5,.5,.5-I,-.5,-.5+e,-.5+I,-.5,-.5,.5-I,-.5,-.5,-.5+I,-.5,-.5,.5-I,-.5,-.5+e,-.5+I,-.5,-.5+e),A.push(1,0,1-I,1,1,1,1-I,1,1,0,1-I,0,I,0,0,1,I,1,0,1,I,0,0,0,1-I,0,I,e,1-I,e,I,e,1-I,0,I,0,1-I,1-e,I,1,1-I,1,I,1,1-I,1-e,I,1-e)),{vs:P,uv:A}}}),s(U.Style,{"csg.cull.color":h,"csg.cull.box":!0,"dw.flip":!1,"dw.s3":[.999,.999,.5],"dw.t3":h,"dw.expanded":!1,"dw.toggleable":!0,"dw.axis":"left","dw.start":0,"dw.end":j/2,"dw.angle":0,"attach.cull":!1,"attach.operation":"subtract"},!0),nq.forEach(function(l){var g={};g[l+q]=!1,g[l+".toggleable"]=!1,g[l+".axis"]=u,g[l+".start"]=0,g[l+".end"]=j/2,g[l+Zb]=0,s(U.Style,g,!0)});var Og=function(){this.$4n=[]};Og.$15n=function(s){var T=new Og;return T.$4n=s,T},Og.prototype={clone:function(){var G=new Og;return G.$4n=this.$4n.map(function(t){return t.clone()}),G},$19n:function(){return this.$4n},union:function(L){var f=new $m(this.clone().$4n),_=new $m(L.clone().$4n);return f.$3n(_),_.$3n(f),_.$6n(),_.$3n(f),_.$6n(),f.$7n(_.$2n()),Og.$15n(f.$2n())},subtract:function(a){var J=new $m(this.clone().$4n),g=new $m(a.clone().$4n);return J.$6n(),J.$3n(g),g.$3n(J),g.$6n(),g.$3n(J),g.$6n(),J.$7n(g.$2n()),J.$6n(),Og.$15n(J.$2n())},intersect:function(D){var C=new $m(this.clone().$4n),W=new $m(D.clone().$4n);return C.$6n(),W.$3n(C),W.$6n(),C.$3n(W),W.$3n(C),C.$7n(W.$2n()),C.$6n(),Og.$15n(C.$2n())},inverse:function(){var s=this.clone();return s.$4n.map(function(e){e.flip()}),s}},Og.cube=function(n){n=n||{};var R=new ao(n.center||[0,0,0]),Y=n.radius?n.radius.length?n.radius:[n.radius,n.radius,n.radius]:[1,1,1];return Og.$15n([[[0,4,6,2],[-1,0,0]],[[1,3,7,5],[1,0,0]],[[0,1,5,4],[0,-1,0]],[[2,6,7,3],[0,1,0]],[[0,2,3,1],[0,0,-1]],[[4,5,7,6],[0,0,1]]].map(function(s){return new Cr(s[0].map(function(k){var j=new ao(R.x+Y[0]*(2*!!(1&k)-1),R.y+Y[1]*(2*!!(2&k)-1),R.z+Y[2]*(2*!!(4&k)-1));return new Jd(j,new ao(s[1]))}))}))},Og.sphere=function(q){function d(x,A){x*=2*j,A*=j;var I=new ao(z(x)*m(A),z(A),m(x)*m(A));H.push(new Jd(_.$20n(I.$21n(J)),I))}q=q||{};for(var H,_=new ao(q.center||[0,0,0]),J=q.radius||1,b=q.slices||16,f=q.stacks||8,l=[],s=0;b>s;s++)for(var y=0;f>y;y++)H=[],d(s/b,y/f),y>0&&d((s+1)/b,y/f),f-1>y&&d((s+1)/b,(y+1)/f),d(s/b,(y+1)/f),l.push(new Cr(H));return Og.$15n(l)},Og.cylinder=function(C){function x(b,a,d){var l=2*a*j,G=T.$21n(z(l)).$20n(H.$21n(m(l))),k=R.$20n(e.$21n(b)).$20n(G.$21n(v)),B=G.$21n(1-K(d)).$20n(P.$21n(d));return new Jd(k,B)}C=C||{};for(var R=new ao(C.start||[0,-1,0]),D=new ao(C.end||[0,1,0]),e=D.$13n(R),v=C.radius||1,N=C.slices||16,P=e.$14n(),a=K(P.y)>.5,T=new ao(a,!a,0).cross(P).$14n(),H=T.cross(P).$14n(),w=new Jd(R,P.$11n()),y=new Jd(D,P.$14n()),h=[],U=0;N>U;U++){var d=U/N,b=(U+1)/N;h.push(new Cr([w,x(0,d,-1),x(0,b,-1)])),h.push(new Cr([x(0,b,0),x(0,d,0),x(1,d,0),x(1,b,0)])),h.push(new Cr([y,x(1,b,1),x(1,d,1)]))}return Og.$15n(h)};var ao=function(m,i,S){var y=this;3==arguments.length?(y.x=m,y.y=i,y.z=S):"x"in m?(y.x=m.x,y.y=m.y,y.z=m.z):(y.x=m[0],y.y=m[1],y.z=m[2])};ao.prototype={clone:function(){return new ao(this.x,this.y,this.z)},$11n:function(){return new ao(-this.x,-this.y,-this.z)},$20n:function(E){return new ao(this.x+E.x,this.y+E.y,this.z+E.z)},$13n:function(X){return new ao(this.x-X.x,this.y-X.y,this.z-X.z)},$21n:function(z){return new ao(this.x*z,this.y*z,this.z*z)},$16n:function(b){return new ao(this.x/b,this.y/b,this.z/b)},dot:function(d){return this.x*d.x+this.y*d.y+this.z*d.z},lerp:function(T,G){return this.$20n(T.$13n(this).$21n(G))},length:function(){return E(this.dot(this))},$14n:function(){return this.$16n(this.length())},cross:function(Q){var Y=this;return new ao(Y.y*Q.z-Y.z*Q.y,Y.z*Q.x-Y.x*Q.z,Y.x*Q.y-Y.y*Q.x)}};var Jd=function(i,p,$){var V=this;V.$24n=new ao(i),V.$22n=p?new ao(p):null,V.uv=$?new ao($):null};Jd.prototype={clone:function(){var I=this;return new Jd(I.$24n.clone(),I.$22n.clone(),I.uv?I.uv.clone():null)},flip:function(){this.$22n=this.$22n.$11n()},$18n:function(D,_){var X=this;return new Jd(X.$24n.lerp(D.$24n,_),X.$22n.lerp(D.$22n,_),X.uv?X.uv.lerp(D.uv,_):null)}};var jh=function(r,N){this.$22n=r,this.w=N};jh.$17n=function(S,k,Y){var x=k.$13n(S).cross(Y.$13n(S)).$14n();return new jh(x,x.dot(S))},jh.prototype={clone:function(){return new jh(this.$22n.clone(),this.w)},flip:function(){var h=this;h.$22n=h.$22n.$11n(),h.w=-h.w},$5n:function(d,h,B,f,e){for(var K=this,E=0,N=1,P=2,T=3,w=0,A=[],C=0;C<d.$9n.length;C++){var D=K.$22n.dot(d.$9n[C].$24n)-K.w,F=-W>D?P:D>W?N:E;w|=F,A.push(F)}switch(w){case E:(K.$22n.dot(d.$8n.$22n)>0?h:B).push(d);break;case N:f.push(d);break;case P:e.push(d);break;case T:for(var c=[],g=[],C=0;C<d.$9n.length;C++){var Q=(C+1)%d.$9n.length,M=A[C],s=A[Q],L=d.$9n[C],R=d.$9n[Q];if(M!=P&&c.push(L),M!=N&&g.push(M!=P?L.clone():L),(M|s)==T){var D=(K.w-this.$22n.dot(L.$24n))/K.$22n.dot(R.$24n.$13n(L.$24n)),t=L.$18n(R,D);c.push(t),g.push(t.clone())}}c.length>=3&&f.push(new Cr(c,d.$10n)),g.length>=3&&e.push(new Cr(g,d.$10n))}}};var Cr=function(f,j){var A=this;A.$9n=f,A.$10n=j,A.$8n=jh.$17n(f[0].$24n,f[1].$24n,f[2].$24n)};Cr.prototype={clone:function(){var G=this.$9n.map(function(t){return t.clone()});return new Cr(G,this.$10n)},flip:function(){this.$9n.reverse().map(function(u){u.flip()}),this.$8n.flip()}};var $m=function(o){var k=this;k.$8n=null,k.front=null,k.back=null,k.$4n=[],o&&k.$7n(o)};$m.prototype={clone:function(){var r=this,t=new $m;return t.$8n=r.$8n&&r.$8n.clone(),t.front=r.front&&r.front.clone(),t.back=r.back&&r.back.clone(),t.$4n=r.$4n.map(function(m){return m.clone()}),t},$6n:function(){for(var n=this,h=0;h<n.$4n.length;h++)n.$4n[h].flip();n.$8n&&n.$8n.flip(),n.front&&n.front.$6n(),n.back&&n.back.$6n();var x=n.front;n.front=n.back,n.back=x},$1n:function(d){var N=this;if(!N.$8n)return d.slice();for(var V=[],c=[],A=0;A<d.length;A++)N.$8n.$5n(d[A],V,c,V,c);return N.front&&(V=N.front.$1n(V)),c=N.back?N.back.$1n(c):[],V.concat(c)},$3n:function(I){var k=this;k.$4n=I.$1n(k.$4n),k.front&&k.front.$3n(I),k.back&&k.back.$3n(I)},$2n:function(){var q=this,v=q.$4n.slice();return q.front&&(v=v.concat(q.front.$2n())),q.back&&(v=v.concat(q.back.$2n())),v},$7n:function(i){var f=this;if(i.length){f.$8n||(f.$8n=i[0].$8n.clone());for(var D=[],o=[],X=0;X<i.length;X++)this.$8n.$5n(i[X],f.$4n,f.$4n,D,o);D.length&&(f.front||(f.front=new $m),this.front.$7n(D)),o.length&&(f.back||(f.back=new $m),f.back.$7n(o))}}};var ye="symbol",ed=U.Symbol=function(H,N,l){var K=this;L(ed,K),K.s3(20,20,20),K.s({"all.visible":!1,shape:"rect"}),K.setIcon(H,N,l)};rq("Symbol",F,{setIcon:function(W,j,X){var P,U=this;return ed.superClass.setIcon.call(U,W),W?(P={for3d:!0,face:"center",position:44,names:[W]},X&&(P.transaprent=!0),j&&(P.autorotate=j),U.addStyleIcon(ye,P)):U.removeStyleIcon(ye),U.setWidth(H.getImageWidth($.getImage(W),U)||20),P}});var yi=U.CSGNode=function(){L(yi,this),this.s({shape:"rect","attach.thickness":1.001,"2d.attachable":!0})},qe={position:1,width:1,height:1,rotation:1,rotationX:1,rotationZ:1,rotationMode:1,tall:1,elevation:1,anchor:1,anchorElevation:1,"s:attach.cull":1,"s:attach.operation":1};rq("CSGNode",F,{_22Q:function(){return Sd},onPropertyChanged:function(k){var L=this,x=L.getHost();yi.superClass.onPropertyChanged.call(L,k),qe[k.property]&&(x instanceof gp||x instanceof yi)&&x.fp("csgNodeChange",!0,!1)}});var Sd=function(v,B){L(Sd,this,[v,B])};k(Sd,l.Node3dUI,{_80o:function(j,I,B){var v=this;v._shape3d?Sd.superClass._80o.call(v,j,I,B):(r(v.gv),Kj.forEach(function(p){N(v,j,I,p,B)}))},validate:function(m,C){var e=this,A=e.gv,$=e.data;if($.s("shape3d"))return Sd.superClass.validate.call(e,m,C),e._shape3d=!0,void 0;e._shape3d=!1;var r=D($,A.getMat($));$.appendAnchorMatrix3d(r);var E=m&&m.uv;e.vf2("csg",E);for(var K=0;6>K;K++)for(var s=nq[K],q=Mc[K],u=e.vf2(s,E,C),v=u.mat||r,b=u.vs,d=u.uv,o=u.tuv,t=0;2>t;t++){var W=Z[q+3*t],z=Z[q+3*t+1],k=Z[q+3*t+2];if(B(b,v,[S[3*W],S[3*W+1],S[3*W+2]]),B(b,v,[S[3*z],S[3*z+1],S[3*z+2]]),B(b,v,[S[3*k],S[3*k+1],S[3*k+2]]),o)if(d){var V=8*K;o.push(d[2*W-V],d[2*W+1-V],d[2*z-V],d[2*z+1-V],d[2*k-V],d[2*k+1-V])}else o.push(G[2*W],G[2*W+1],G[2*z],G[2*z+1],G[2*k],G[2*k+1])}Pm(e,m,C)},vf2:function(G,X,y){var I,Y=this,C=Y.gv.getFaceVisible(Y.data,G);return I=M(Y,G,y),I.vs=[],I.tuv=C&&(I.texture||X)?[]:_,I.visible=C,I}});var gp=U.CSGShape=function(){var m=this;L(gp,m),m.s({"shape.background":_,"2d.hostable":!0,"shape.border.width":8}),m.setTall(240),m.setElevation(120),m.setThickness(14)};rq("CSGShape",b,{IRotatable:!1,_22Q:function(){return Ti},setRotationX:function(){},setRotation:function(){},setRotationZ:function(){},setSegments:function(){}});var Ti=function(t,n){L(Ti,this,[t,n])};k(Ti,l.Shape3dUI,{_80o:function(y,x,T){var G=this;G.undrawable||(r(G.gv),Kj.forEach(function(F){N(G,y,x,F,T)}))},validate:function(A,i){var P=this,F=P.data,D=F.getPoints();if(P.undrawable=D.size()<2)return P.clear(),void 0;var Q=F.isClosePath(),d=c(F._thickness/2,W),I=T(D,_,_,Q);Kj.forEach(function(T){P.vf(T,A&&A.uv,!0,i)}),Q&&(P.left.visible=!1,P.right.visible=!1),P._12O(I,d),P._20Q(I);var b=F.getPointsMatrix3d(),x=U.Math.requestVector3();nq.forEach(function(U){if(P[U])for(var C=P[U].vs,k=0,o=C.length;o>k;k+=3)x.set(C[k],C[k+1],C[k+2]).applyMatrix4(b),C[k]=x.x,C[k+1]=x.y,C[k+2]=x.z}),U.Math.releaseVector3(x),Pm(P,A,i)}});var Yo=U.DoorWindow=function(){var V=this;L(Yo,V),V.setElevation(100),V.s3(100,200,14)};rq("DoorWindow",yi,{IDoorWindow:!0,toggle:function(A){this.setExpanded(!this.s(o),A)},isExpanded:function(){return this.s(o)},setExpanded:function(d,j){var Z=this,_=Z.$25n,P=Z.s(o);if(_&&(_.stop(!0),delete Z.$25n),P!==d){Z.beginTransaction();var N=d?Z.s("dw.end"):Z.s("dw.start");Z.s(o,d),j=i(j),j?(P=Z.s(om),j.action=function(V){Z.s(om,P+(N-P)*V)},j.finishFunc=function(){Z.endTransaction()},Z.$25n=I(j)):(Z.s(om,N),Z.endTransaction())}},getMat:function(){var b=this,w=b.s("dw.s3"),Z=b.s("dw.t3"),L=b.s("dw.flip"),e=b.s(om);if(w||e||Z||L){var K=[];if(L&&K.push({r3:[0,j,0]}),w&&K.push({s3:w}),e){w=b.getFinalScale3d();var q=b.s("dw.axis"),l=w[0]/2,o=w[1]/2;w[2]/2,q===u?K.push({t3:[l,0,0]},{r3:[0,-e,0]},{t3:[-l,0,0]}):q===A?K.push({t3:[-l,0,0]},{r3:[0,e,0]},{t3:[l,0,0]}):q===Y?K.push({t3:[0,-o,0]},{r3:[-e,0,0]},{t3:[0,o,0]}):q===P?K.push({t3:[0,o,0]},{r3:[e,0,0]},{t3:[0,-o,0]}):q===x?K.push({r3:[0,e,0]}):q===Q&&K.push({r3:[e,0,0]})}return Z&&K.push({t3:Z}),n(K)}return _}});var on=U.CSGBox=function(){var y=this;L(on,y),y.setElevation(100),y.s3(100,200,100)};rq("CSGBox",yi,{ICSGBox:!0,toggleFace:function(s,R){this.setFaceExpanded(s,!this.s(s+q),R)},isFaceExpanded:function(r){return this.s(r+q)},setFaceExpanded:function(L,t,H){var $=this,T=$.$25n,V=$.s(L+q);if(T&&(T.stop(!0),delete $.$25n),V!==t){var M=t?$.s(L+".end"):$.s(L+".start");$.s(L+q,t),H=i(H),H?(V=$.s(L+Zb),H.action=function(i){$.s(L+Zb,V+(M-V)*i)},$.$25n=I(H)):$.s(L+Zb,M)}},getFaceMat:function(c){var W=this,x=W.s(c+Zb);if(!x)return _;var A,Y,w,m,l,u,$=W.s(c+".axis"),r=W.getFinalScale3d(),R=W.getAnchor3d(),p=r[0]*R.x,k=r[1]*R.y,H=r[2]*R.z,N=r[0]-p,T=r[1]-k,y=r[2]-H,M=c+"_"+$;switch(M){case"front_left":A=-p,Y=0,w=y,m=0,l=-x,u=0;break;case"front_right":A=N,Y=0,w=y,m=0,l=x,u=0;break;case"front_top":A=0,Y=T,w=y,m=-x,l=0,u=0;break;case"front_bottom":A=0,Y=-k,w=y,m=x,l=0,u=0;break;case"front_h":A=0,Y=0,w=y,m=x,l=0,u=0;break;case"front_v":A=0,Y=0,w=y,m=0,l=x,u=0;break;case"back_left":A=N,Y=0,w=-H,m=0,l=-x,u=0;break;case"back_right":A=-p,Y=0,w=-H,m=0,l=x,u=0;break;case"back_top":A=0,Y=T,w=-H,m=x,l=0,u=0;break;case"back_bottom":A=0,Y=-k,w=-H,m=-x,l=0,u=0;break;case"back_h":A=0,Y=0,w=-H,m=x,l=0,u=0;break;case"back_v":A=0,Y=0,w=-H,m=0,l=x,u=0;break;case"left_left":A=-p,Y=0,w=-H,m=0,l=-x,u=0;break;case"left_right":A=-p,Y=0,w=y,m=0,l=x,u=0;break;case"left_top":A=-p,Y=T,w=0,m=0,l=0,u=-x;break;case"left_bottom":A=-p,Y=-k,w=0,m=0,l=0,u=x;break;case"left_h":A=-p,Y=0,w=0,m=0,l=0,u=x;break;case"left_v":A=-p,Y=0,w=0,m=0,l=x,u=0;break;case"right_left":A=N,Y=0,w=y,m=0,l=-x,u=0;break;case"right_right":A=N,Y=0,w=-H,m=0,l=x,u=0;break;case"right_top":A=N,Y=T,w=0,m=0,l=0,u=x;break;case"right_bottom":A=N,Y=-k,w=0,m=0,l=0,u=-x;break;case"right_h":A=N,Y=0,w=0,m=0,l=0,u=x;break;case"right_v":A=N,Y=0,w=0,m=0,l=x,u=0;break;case"top_left":A=-p,Y=T,w=0,m=0,l=0,u=x;break;case"top_right":A=N,Y=T,w=0,m=0,l=0,u=-x;break;case"top_top":A=0,Y=T,w=-H,m=-x,l=0,u=0;break;case"top_bottom":A=0,Y=T,w=y,m=x,l=0,u=0;break;case"top_h":A=0,Y=T,w=0,m=x,l=0,u=0;break;case"top_v":A=0,Y=T,w=0,m=0,l=0,u=x;break;case"bottom_left":A=-p,Y=-k,w=0,m=0,l=0,u=-x;break;case"bottom_right":A=N,Y=-k,w=0,m=0,l=0,u=x;break;case"bottom_top":A=0,Y=-k,w=y,m=-x,l=0,u=0;break;case"bottom_bottom":A=0,Y=-k,w=-H,m=x,l=0,u=0;break;case"bottom_h":A=0,Y=-k,w=0,m=x,l=0,u=0;break;case"bottom_v":A=0,Y=-k,w=0,m=0,l=0,u=x}return n([{t3:[-A,-Y,-w]},{r3:[m,l,u]},{t3:[A,Y,w]}])}});var jm=function(M,t,v,m,H){function T(){var o,u=[],j=new R,b=new R;for(K.eachShapeModel(function(w,_,R){for(var D=0,X=_?_.length:w.length/3;X>D;D++)_?(j.fromArray(w,3*_[D]),b.fromArray(R,3*_[D])):(j.fromArray(w,3*D),b.fromArray(R,3*D)),p(u,j,b)}),u=I(u,O.set(1,0,0)),u=I(u,O.set(-1,0,0)),u=I(u,O.set(0,1,0)),u=I(u,O.set(0,-1,0)),u=I(u,O.set(0,0,1)),u=I(u,O.set(0,0,-1)),o=0;o<u.length;o++){var f=u[o];r.push(.5+f.position.x/H.x,.5-f.position.y/H.y),f.position.applyMatrix4(l),G.push(f.position.x,f.position.y,f.position.z),k.push(f.$22n.x,f.$22n.y,f.$22n.z)}}function p(H,r,u){r.applyMatrix4(J),r.applyMatrix4(L),u.transformDirection(J),u.transformDirection(L),H.push(new V(r.clone(),u.clone()))}function I(w,p){for(var o=[],c=.5*Math.abs(H.dot(p)),E=0;E<w.length;E+=3){var i,f,K,B,N,F,G,I=0,y=w[E+0].position.dot(p)-c,a=w[E+1].position.dot(p)-c,W=w[E+2].position.dot(p)-c;switch(i=y>0,f=a>0,K=W>0,I=(i?1:0)+(f?1:0)+(K?1:0)){case 0:o.push(w[E]),o.push(w[E+1]),o.push(w[E+2]);break;case 1:if(i&&(B=w[E+1],N=w[E+2],F=S(w[E],B,p,c),G=S(w[E],N,p,c)),f){B=w[E],N=w[E+2],F=S(w[E+1],B,p,c),G=S(w[E+1],N,p,c),o.push(F),o.push(N.clone()),o.push(B.clone()),o.push(N.clone()),o.push(F.clone()),o.push(G);break}K&&(B=w[E],N=w[E+1],F=S(w[E+2],B,p,c),G=S(w[E+2],N,p,c)),o.push(B.clone()),o.push(N.clone()),o.push(F),o.push(G),o.push(F.clone()),o.push(N.clone());break;case 2:i||(B=w[E].clone(),N=S(B,w[E+1],p,c),F=S(B,w[E+2],p,c),o.push(B),o.push(N),o.push(F)),f||(B=w[E+1].clone(),N=S(B,w[E+2],p,c),F=S(B,w[E],p,c),o.push(B),o.push(N),o.push(F)),K||(B=w[E+2].clone(),N=S(B,w[E],p,c),F=S(B,w[E+1],p,c),o.push(B),o.push(N),o.push(F));break;case 3:}}return o}function S(U,d,g,F){var B=U.position.dot(g)-F,C=d.position.dot(g)-F,Z=B/(B-C),Q=new V(new R(U.position.x+Z*(d.position.x-U.position.x),U.position.y+Z*(d.position.y-U.position.y),U.position.z+Z*(d.position.z-U.position.z)),new R(U.$22n.x+Z*(d.$22n.x-U.$22n.x),U.$22n.y+Z*(d.$22n.y-U.$22n.y),U.$22n.z+Z*(d.$22n.z-U.$22n.z)));return Q}var G=[],k=[],r=[],O=new R,K=M.getData3dUI(t);if(K.mat){var J=(new d).fromArray(K.mat),u=new d;u.makeRotationFromEuler(m),u.setPosition(v);var L=(new d).getInverse(u),l=(new d).scale({x:1/H.x,y:1/H.y,z:1/H.z});return T(),{vs:G,ns:k,uv:r}}};V.prototype.clone=function(){return new V(this.position.clone(),this.$22n.clone())};var Po=function(G,g,t,L){var B=this,m=B.getDataAt(G);if(m){var l=B.intersectObject(G,m);if(l){"object"==typeof g?g=g.x?new R(g.x,g.y,g.z):new R(g[0],g[1],g[2]):(g=g||20,g=new R(g,g,g)),t=t===h?.1:t;var N=new R(B.getUp()),O=new R(B.getCenter()).sub(new R(B.getEye())).normalize(),z="cross",u=O.clone()[z](N).normalize();N.copy(u)[z](O).normalize(),L&&N.applyAxisAngle(l.worldNormal,-L);var V=new U.Node,K=l.worldNormal.clone().setLength(t).add(l.world),D=(new d).lookAt(l.worldNormal.clone(),new R(0,0,0),N),W=(new w).setFromRotationMatrix(D),Q=jm(B,m,l.world.clone(),W,g);return V.p3(K.x,K.y,K.z),V.setEuler(W),V.s3(g.x,g.y,g.z),V.s({shape3d:Q,"shape3d.reverse.flip":!0}),V}}};s(U.graph3d.Graph3dView,{createDecal:Po})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);
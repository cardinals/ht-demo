!function(T,N,X){"use strict";var _=T.ht;_.Astar={},function(d){var N=d();T.AStar=N.astar,T.AStar.Graph=N.Graph}(function(){function R(T){for(var z=T,$=[];z.parent;)$.unshift(z),z=z.parent;return $}function s(){return new E(function(d){return d.f})}function G(O,V){V=V||{},this.nodes=[],this.diagonal=!!V.diagonal,this.grid=[];for(var $=0;$<O.length;$++){this.grid[$]=[];for(var v=0,M=O[$];v<M.length;v++){var X=new x($,v,M[v]);this.grid[$][v]=X,this.nodes.push(X)}}this.$13x()}function x(S,d,t){this.x=S,this.y=d,this.weight=t}function E(D){this.content=[],this.scoreFunction=D}var m={search:function(d,D,A,x){d.$6x(),x=x||{};var M=x.heuristic;M||(M=d.diagonal?m.$4x.diagonal:m.$4x.manhattan);var a=x.closest||!1,Q=x.punish,u=s(),I=D;for(D.h=M(D,A),d.$7x(D),u.push(D);u.size()>0;){var e=u.pop();if(e===A)return R(e);e.closed=!0;for(var N=d.neighbors(e),y=0,n=N.length;n>y;++y){var T=N[y];if(!T.closed&&!T.$9x()){var F=e.g+T.getCost(e,Q),K=T.visited;(!K||F<T.g)&&(T.visited=!0,T.parent=e,T.h=T.h||M(T,A),T.g=F,T.f=T.g+T.h,d.$7x(T),a&&(T.h<I.h||T.h===I.h&&T.g<I.g)&&(I=T),K?u.$10x(T):u.push(T))}}}return a?R(I):[]},$4x:{manhattan:function(J,P){var V=Math.abs(P.x-J.x),S=Math.abs(P.y-J.y);return V+S},diagonal:function(O,q){var W=1,s=Math.sqrt(2),e=Math.abs(q.x-O.x),d=Math.abs(q.y-O.y);return W*(e+d)+(s-2*W)*Math.min(e,d)}},$5x:function(l){l.f=0,l.g=0,l.h=0,l.visited=!1,l.closed=!1,l.parent=null}};return G.prototype.$13x=function(){this.dirtyNodes=[];for(var S=0;S<this.nodes.length;S++)m.$5x(this.nodes[S])},G.prototype.$6x=function(){for(var G=0;G<this.dirtyNodes.length;G++)m.$5x(this.dirtyNodes[G]);this.dirtyNodes=[]},G.prototype.$7x=function($){this.dirtyNodes.push($)},G.prototype.neighbors=function(X){var a=[],H=X.x,i=X.y,v=this.grid;return v[H-1]&&v[H-1][i]&&a.push(v[H-1][i]),v[H+1]&&v[H+1][i]&&a.push(v[H+1][i]),v[H]&&v[H][i-1]&&a.push(v[H][i-1]),v[H]&&v[H][i+1]&&a.push(v[H][i+1]),this.diagonal&&(v[H-1]&&v[H-1][i-1]&&a.push(v[H-1][i-1]),v[H+1]&&v[H+1][i-1]&&a.push(v[H+1][i-1]),v[H-1]&&v[H-1][i+1]&&a.push(v[H-1][i+1]),v[H+1]&&v[H+1][i+1]&&a.push(v[H+1][i+1])),a},G.prototype.toString=function(){for(var I=[],r=this.grid,s=0;s<r.length;s++){for(var k=[],y=r[s],m=0;m<y.length;m++)k.push(y[m].weight);I.push(k.join(" "))}return I.join("\n")},x.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},x.prototype.getCost=function(m,I){var b;if(b=m&&m.x!=this.x&&m.y!=this.y?1.41421*this.weight:this.weight,I){var p=m;if(!p)return b;var L=p.parent;if(!L)return b;if(Math.abs(L.x+this.x-2*p.x)>1e-5)return b+I;if(Math.abs(L.y+this.y-2*p.y)>1e-5)return b+I}return b},x.prototype.$9x=function(){return 0===this.weight},E.prototype={push:function(q){this.content.push(q),this.$11x(this.content.length-1)},pop:function(){var Y=this.content[0],H=this.content.pop();return this.content.length>0&&(this.content[0]=H,this.$12x(0)),Y},remove:function(F){var c=this.content.indexOf(F),L=this.content.pop();c!==this.content.length-1&&(this.content[c]=L,this.scoreFunction(L)<this.scoreFunction(F)?this.$11x(c):this.$12x(c))},size:function(){return this.content.length},$10x:function(I){this.$11x(this.content.indexOf(I))},$11x:function(L){for(var M=this.content[L];L>0;){var I=(L+1>>1)-1,R=this.content[I];if(!(this.scoreFunction(M)<this.scoreFunction(R)))break;this.content[I]=M,this.content[L]=R,L=I}},$12x:function(U){for(var $=this.content.length,b=this.content[U],Y=this.scoreFunction(b);;){var u,X=U+1<<1,e=X-1,V=null;if($>e){var O=this.content[e];u=this.scoreFunction(O),Y>u&&(V=e)}if($>X){var Q=this.content[X],D=this.scoreFunction(Q);(null===V?Y:u)>D&&(V=X)}if(null===V)break;this.content[U]=this.content[V],this.content[V]=b,U=V}}},{astar:m,Graph:G}});var n=_.Astar.Finder=function(o,k){var A=this;A.gv=o,A.$13x(k),A.refreshMap()};n.prototype={},n.prototype.constructor=n,N.defineProperties(n.prototype,{_debugInfo:{get:function(){return this.gv._astarDebugInfo},set:function(a){this.gv._astarDebugInfo=a}}}),n.prototype.$13x=function(_){var P=this,x=P.$14x={};_=_||{};var l=_.gridSize||10;x.gridSizeX=_.gridSizeX||l,x.gridSizeY=_.gridSizeY||l,x.rect=_.rect,x.filter=_.filter,x.extendBlocks=_.extendBlocks||3,x.fastOverlap=_.fastOverlap===X?!0:_.fastOverlap,x.nodeRectExtend=_.nodeRectExtend||0,x.diagonal=_.diagonal===X?!0:_.diagonal,x.turnPunish=_.turnPunish===X?.1:_.turnPunish,x.simplify=_.simplify===X?!0:_.simplify,x.toGridCenter=_.toGridCenter===X?!1:_.toGridCenter,x.closest=_.closest===X?!0:_.closest},n.prototype.refreshMap=function(){var e,x=this,L=x.$14x,q=L.gridSizeX,j=L.gridSizeY,V=L.extendBlocks;L.rect?e=L.rect:(e=x.$15x(),_.Default.grow(e,q*V,j*V)),_.Default.grow(e,q,j);var N=Math.floor(e.x/q)*q,p=Math.floor(e.y/j)*j,A=Math.ceil(e.width/q),z=Math.ceil(e.height/j),h=A*q,Y=z*j;x.$16x={x:N,y:p,w:h,h:Y,gridX:q,gridY:j,xLen:A,yLen:z},x.$17x(),x.$21x()},n.prototype.$15x=function(){var q=this.gv;if(q instanceof _.graph.GraphView)return q.getContentRect();var S,X=_.Default.unionRect;return q.dm().each(function(n){q.isVisible(n)&&n.getRect&&(S=X(S,n.getRect()))}),S},n.prototype.$17x=function(){var g,j,Y,T,H=this,y=H.$16x,V=y.xLen,i=y.yLen;for(g=new Array(V),Y=0;V>Y;Y++)for(g[Y]=j=new Array(i),T=i;T--;)j[T]=1;var W=H.$14x.filter;for(H.gv.dm().each(function(b){W&&W(b)===!1||(!H._debugInfo||b!==H._debugInfo.grid&&b!=H._debugInfo.path)&&H.$1cw(g,b)}),Y=0;V>Y;Y++)g[Y][0]=1,g[Y][i-1]=1;for(T=0;i>T;T++)g[0][T]=1,g[V-1][T]=1;H.grid=g;var X=new AStar.Graph(g,{diagonal:H.$14x.diagonal});H.graph=X},n.prototype.$18x=function(u,c,w,d,e,R,A,V){var O=this.$19x,b=O(w-u,e-A,d-c,R-V);if(1e-6>=b&&b>=-1e-6)return!1;var i=O(e-u,e-A,R-c,R-V)/b;if(0>i||i>1)return!1;var G=O(w-u,e-u,d-c,R-c)/b;return 0>G||G>1?!1:!0},n.prototype.$19x=function(l,N,p,t){return l*t-N*p},n.prototype.$1aw=function(o,j,c,I){for(var f=[-(j[1]-o[1]),j[0]-o[0]],r=f[0]*(c[0]-o[0])+f[1]*(c[1]-o[1])>=0,S=0,b=I.length;b>S;S+=2)if(f[0]*(I[S]-o[0])+f[1]*(I[S+1]-o[1])>=0===r)return!1;return!0},n.prototype.$1bw=function(I,t){for(var h,O,B=this,G=0,v=I.length;v>G;G+=2)if(h=G===v-2?0:G+2,O=h===v-2?0:h+2,B.$1aw([I[G],I[G+1]],[I[h],I[h+1]],[I[O],I[O+1]],t))return!1;for(var G=0,v=t.length;v>G;G+=2)if(h=G===v-2?0:G+2,O=h===v-2?0:h+2,B.$1aw([t[G],t[G+1]],[t[h],t[h+1]],[t[O],t[O+1]],I))return!1;return!0},n.prototype.$1cw=function(S,v){if(v.getRect){var P=this,z=v.getRect();_.Default.grow(z,P.$14x.nodeRectExtend);var J,e,j,X,u,L,d,C,E,p,s,T=P.$1dw({x:z.x,y:z.y}),O=P.$1dw({x:z.x+z.width,y:z.y+z.height}),m=P.$14x.fastOverlap;if(!m){var Q=v.getCorners();d=[],Q.forEach(function(T){d.push(T.x,T.y)}),p=P.$14x.gridSizeX/2,s=P.$14x.gridSizeY/2}for(e=Math.max(0,T.x),j=Math.min(O.x,S.length-1),u=Math.max(0,T.y),L=Math.min(O.y,S.length?S[0].length-1:-1),J=e;j>=J;J++)for(X=u;L>=X;X++)if(m)S[J][X]=0;else{E=P.$1ew({x:J,y:X});var I=E.x-p,k=E.x+p,A=E.y-s,D=E.y+s;C=[I,A,I,D,k,D,k,A],P.$1bw(d,C)&&(S[J][X]=0)}}},n.prototype.$1dw=function(l,d){var f=this,R=f.$16x,p=(l.x-R.x)/R.gridX,L=(l.y-R.y)/R.gridY;return d!==!1&&(p=Math.round(p),L=Math.round(L)),{x:p,y:L}},n.prototype.$1ew=function(W){var a=this,R=a.$16x;return{x:W.x*R.gridX+R.x,y:W.y*R.gridY+R.y}},n.prototype.$1fw=function(O){var m=this,A=m.$16x,i=A.xLen,P=A.yLen;if(O.x>=0&&O.x<i&&O.y>=0&&O.y<P)return O;var u={x:O.x,y:O.y};return u.x<0?u.x=0:u.x>=i&&(u.x=i-1),u.y<0?u.y=0:u.y>=P&&(u.y=P-1),u},n.prototype.findPath=function(Q,L){var p,n,W,k,P=this,D=P.$1dw(Q),F=P.$1dw(L);if(W=P.$1fw(D),k=P.$1fw(F),W!==D&&k!==F){var q=P.$16x,d=q.x-q.gridX/2,j=q.y-q.gridY/2,E=d+q.gridX*q.xLen,x=j+q.gridY*q.yLen;if(!(P.$18x(Q.x,Q.y,L.x,L.y,d,j,E,j)||P.$18x(Q.x,Q.y,L.x,L.y,E,j,E,x)||P.$18x(Q.x,Q.y,L.x,L.y,E,x,d,x)||P.$18x(Q.x,Q.y,L.x,L.y,d,x,d,j)))return[Q,L]}W!==D&&(p=!0,D=W),k!==F&&(n=!0,F=k);var G=P.graph.grid[D.x][D.y],a=P.graph.grid[F.x][F.y],B=AStar.search(P.graph,G,a,{closest:P.$14x.closest,punish:P.$14x.turnPunish});if(!B||!B.length)return null;var H=[];H.push(Q),p&&H.push(P.$1ew(B[0]));for(var i=1,O=B.length;O-1>i;i++)H.push(P.$1ew(B[i]));if(n)H.push(P.$1ew(B[O-1])),H.push(L);else{var Z=B[O-1];F.x!==Z.x||F.y!==Z.y||P.$14x.toGridCenter?H.push(P.$1ew(Z)):H.push(L)}return P.$14x.simplify&&(H=P.simplifyPath(H)),P.$20x=H,P.$21x(),H},n.prototype.debugOn=function(r){this.debugFlag=!0,this.debugSettings=r||{},this.$21x()},n.prototype.simplifyPath=function(G){var q=G.length;if(2>=q)return G;var w,B,A=[G[0],G[1]],L=A[0],b=A[1],C=1e-5;for(w=2;q>w;w++)B=G[w],Math.abs((b.x-L.x)*(B.y-L.y)-(b.y-L.y)*(B.x-L.x))<C?b=A[A.length-1]=B:(L=b,b=B,A.push(B));return A},n.prototype.$21x=function(){var i=this;if(i.$22x(),this.debugFlag){var o=i.grid;if(o){var M,s=i.gv;if(i.debugSettings.$16x!==!1){M=[];for(var U,p,Z,l,m,t=[],P=i.$14x.gridSizeX/2,N=i.$14x.gridSizeY/2,e=o.length,f=e?o[0].length:0,w=1;e-1>w;w++)for(var k=1;f-1>k;k++)o[w][k]||(U=i.$1ew({x:w,y:k}),p=U.x-P,Z=U.x+P,l=U.y-N,m=U.y+N,M.push({x:p,y:l},{x:p,y:m},{x:Z,y:m},{x:Z,y:l}),t.push(1,2,2,2,5));var Y=new _.Shape;Y.s("shape.border.color","rgba(50, 50, 50, 0.2)"),Y.s("shape.border.width",1),Y.s("shape.background","rgba(200, 50, 100, 0.2)"),Y.s("2d.editable",!1),Y.s("2d.selectable",!1),Y.setPoints(M),Y.setSegments(t),i._debugInfo={grid:Y},s.dm().add(Y)}i.debugSettings.path!==!1&&(M=new _.Shape,i.$20x&&(M.setPoints(i.$20x),M.s("shape.border.color","red"),M.s("shape.border.width",1),M.s("2d.editable",!1),M.s("2d.selectable",!1),M.s("shape.background",null),i._debugInfo||(i._debugInfo={}),i._debugInfo.path=M,s.dm().add(M)))}}},n.prototype.debugOff=function(){this.debugFlag=!1,this.$22x()},n.prototype.$22x=function(){var Q=this;if(Q._debugInfo){var M=Q._debugInfo.grid,o=Q._debugInfo.path,I=Q.gv;M&&I.dm().remove(M),o&&I.dm().remove(o),Q._debugInfo=null}}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);
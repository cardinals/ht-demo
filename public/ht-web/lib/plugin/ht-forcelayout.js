!function(A,M){"use strict";var U="ht",S=U+".layout.",N=A[U]||module.parent.exports.ht,Z=N.List,h=N.DataModel,$=N.Node,n=N.Edge,e=N.Group,Y=Math,y=Y.sqrt,z=Y.random,R=Y.max,G=Y.min,u=function(v){return v*v};N.Default.getInternal().addMSMap({ms_force:function(J){J._interval=50,J._stepCount=10,J._motionLimit=.01,J._edgeRepulsion=.65,J._nodeRepulsion=.65,J._damper=1,J._maxMotion=0,J._motionRatio=0,J.init=function(V){var F=this;V instanceof h?F.dm=V:F.gv=V,F._nodeMap={},F._nodes=new Z,F._edges=new Z},J.start=function(){var I=this,n=I.gv;if(!I._timer){var K=I.cdm=n?n.dm():I.dm;K.mm(I.handleDataModelChange,I),K.md(I.handleDataPropertyChange,I),n&&n.mp(I.handleGV,I),K.each(function(n){if(I.isVisible(n)&&I.isLayoutable(n)&&n instanceof $)if(I instanceof T){var N=n.p3();n.p3([N[0]+z(),N[1]+z(),N[2]+z()])}else N=n.p(),n.p(N.x+z(),N.y+z())}),I._timer=setInterval(function(){I.relax()},I._interval),I._damper=1}},J.stop=function(){var i=this;i._timer&&(i.cdm.umm(i.handleDataModelChange,i),i.cdm.umd(i.handleDataPropertyChange,i),i.gv&&i.gv.ump(i.handleGV,i),clearInterval(i._timer),delete i._timer,delete i.cdm)},J.handleGV=function(e){var B=this;if("dataModel"===e.property){var s=e.oldValue,p=e.newValue;s&&(s.umm(B.handleDataModelChange,B),s.umd(B.handleDataPropertyChange,B)),this.cdm=p,p.mm(B.handleDataModelChange,B),p.md(B.handleDataPropertyChange,B)}},J.relax=function(){var Z=this;if(!(Z._damper<.1&&Z._maxMotion<Z._motionLimit)){this.cdm.each(function(k){Z.isVisible(k)&&(k instanceof n?Z.addEdge(k):k instanceof $&&Z.addNode(k))});for(var H,O,I=0,W=Z._edges,v=Z._nodes,e=v.size();I<Z._stepCount;I++){for(W.each(Z.relaxEdge,Z),H=0;e>H;H++)for(O=0;e>O;O++)Z.relaxNode(v.get(H),v.get(O));Z.moveNode()}Z._isAdjusting=1,v.each(function(Z){Z.fix||(Z.p?Z.v.p3(Z.p):Z.v.p(Z.x,Z.y))}),delete Z._isAdjusting,Z._nodeMap={},v.clear(),W.clear(),Z.onRelaxed()}},J.onRelaxed=function(){},J.isRunning=function(){return!!this._timer},J.isVisible=function(Q){return Q.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(Q):!0},J.isLayoutable=function(R){if(R.s("layoutable")===!1)return!1;if(R instanceof e)return!1;var d=this;return d.gv?d.gv.isMovable(R)&&!d.gv.isSelected(R):!(d.cdm||d.dm).sm().co(R)},J.getNodeRepulsion=function(){return this._nodeRepulsion},J.setNodeRepulsion=function(d){this._nodeRepulsion=d,this._damper=1},J.getEdgeRepulsion=function(){return this._edgeRepulsion},J.setEdgeRepulsion=function(K){this._edgeRepulsion=K,this._damper=1},J.getStepCount=function(){return this._stepCount},J.setStepCount=function(a){this._stepCount=a,this._damper=1},J.getInterval=function(){return this._interval},J.setInterval=function(W){var a=this;a._interval!==W&&(a._interval=W,a._timer&&(clearInterval(a._timer),a._timer=setInterval(function(){a.relax()},W)))},J.handleDataPropertyChange=function(r){!this._isAdjusting&&this.isVisible(r.data)&&(this._damper=1)},J.handleDataModelChange=function(){this._damper=1},J.damp=function(){var e=this._maxMotion,$=this._damper;this._motionRatio<=.001&&((.2>e||e>1&&.9>$)&&$>.01?this._damper-=.01:.4>e&&$>.003?this._damper-=.003:$>1e-4&&(this._damper-=1e-4)),e<this._motionLimit&&(this._damper=0)}}}),N.layout.ForceLayout=function(z){this.init(z)},N.Default.def(S+"ForceLayout",M,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(g){this._limitBounds=g,this._damper=1},getNodeSize:function(P){var e=this.gv;return e&&e.getDataUIBounds?e.getDataUIBounds(P):P.getRect()},addNode:function(l){var $=this,B=$._nodeMap[l._id];if(B)return B;var k=l.p();B={v:l,x:k.x,y:k.y,dx:0,dy:0,fix:!$.isLayoutable(l),s:$.getNodeSize(l)};var d=B.s,s=y(u(d.width)+u(d.height))*$._nodeRepulsion;return B.r=1>s?100:s,$._nodeMap[l._id]=B,$._nodes.add(B),B},addEdge:function(c){if(c._40I&&c._41I){var W=this,u=W.addNode(c._40I),U=W.addNode(c._41I),Y={s:u,t:U};U=U.s,u=u.s;var O=U.width+u.width,d=U.height+u.height;Y.length=y(O*O+d*d)*W._edgeRepulsion,Y.length<=0&&(Y.length=100),W._edges.add(Y)}},relaxEdge:function(g){var k=g.t,H=g.s,z=k.x-H.x,t=k.y-H.y,F=y(z*z+t*t),w=100*g.length,v=.25*z/w*F,U=.25*t/w*F;k.dx=k.dx-v,k.dy=k.dy-U,H.dx=H.dx+v,H.dy=H.dy+U},relaxNode:function(D,L){if(D!==L){var S=0,q=0,r=D.x-L.x,m=D.y-L.y,k=r*r+m*m;0===k?(S=z(),q=z()):36e4>k&&(S=r/k,q=m/k);var U=D.r*L.r/400;S*=U,q*=U,D.dx+=S,D.dy+=q,L.dx-=S,L.dy-=q}},moveNode:function(){var j=this,C=j._limitBounds,e=j._maxMotion,v=0,L=j._damper;j._nodes.each(function($){if(!$.fix){var S=$.dx*L,i=$.dy*L;if($.dx=S/2,$.dy=i/2,v=R(y(S*S+i*i),v),$.x+=R(-40,G(40,S)),$.y+=R(-40,G(40,i)),C){$.x<C.x&&($.x=C.x,j.adjust(1,0)),$.y<C.y&&($.y=C.y,j.adjust(0,1));var g=$.s;$.x+g.width>C.x+C.width&&($.x=C.x+C.width-g.width,j.adjust(-1,0)),$.y+g.height>C.y+C.height&&($.y=C.y+C.height-g.height,j.adjust(0,-1))}}}),j._maxMotion=v,j._motionRatio=v>0?e/v-1:0,j.damp()},adjust:function(Y,z){var N=this._limitBounds;this._nodes.each(function(k){Y>0?(!N||k.x+k.s.width+Y<N.x+N.width)&&(k.x+=Y):(!N||k.x+Y>N.x)&&(k.x+=Y),z>0?(!N||k.y+k.s.height+z<N.y+N.height)&&(k.y+=z):(!N||k.y+z>N.y)&&(k.y+=z)})}});var T=N.layout.Force3dLayout=function(F){this.init(F)};N.Default.def(S+"Force3dLayout",M,{ms_force:1,getNodeSize3d:function(k){return k.s3()},addNode:function(y){var U=this,q=U._nodeMap[y._id];if(q)return q;q={v:y,p:y.p3(),d:[0,0,0],fix:!U.isLayoutable(y),s:U.getNodeSize3d(y)};var E=q.s,g=N.Default.getDistance(E)*U._nodeRepulsion;return q.r=1>g?100:g,U._nodeMap[y._id]=q,U._nodes.add(q),q},addEdge:function(L){if(L._40I&&L._41I){var j=this,U=j.addNode(L._40I),W=j.addNode(L._41I),a={s:U,t:W};W=W.s,U=U.s,a.length=y(u(W[0]+U[0])+u(W[1]+U[1])+u(W[2]+U[2]))*j._edgeRepulsion,a.length<=0&&(a.length=100),j._edges.add(a)}},relaxEdge:function(g){var j=g.t.p,R=g.s.p,v=g.t.d,s=g.s.d,q=j[0]-R[0],A=j[1]-R[1],f=j[2]-R[2],I=y(q*q+A*A+f*f),z=100*g.length,r=.25*q/z*I,b=.25*A/z*I,x=.25*f/z*I;v[0]-=r,v[1]-=b,v[2]-=x,s[0]+=r,s[1]+=b,s[2]+=x},relaxNode:function(C,T){if(C!==T){var V=C.p,t=T.p,r=0,o=0,$=0,M=V[0]-t[0],D=V[1]-t[1],E=V[2]-t[2],W=M*M+D*D+E*E;0===W?(r=z(),o=z(),$=z()):216e6>W&&(r=M/W,o=D/W,$=E/W);var y=C.r*T.r/400,U=C.d,O=T.d;r*=y,o*=y,$*=y,U[0]+=r,U[1]+=o,U[2]+=$,O[0]-=r,O[1]-=o,O[2]-=$}},moveNode:function(){var $=this,X=$._maxMotion,d=0,A=$._damper;$._nodes.each(function(v){if(!v.fix){var q=v.p,Z=v.d,X=Z[0]*A,c=Z[1]*A,m=Z[2]*A;Z[0]=X/2,Z[1]=c/2,Z[2]=m/2,d=R(y(X*X+c*c+m*m),d),q[0]+=R(-40,G(40,X)),q[1]+=R(-40,G(40,c)),q[2]+=R(-40,G(40,m))}}),$._maxMotion=d,$._motionRatio=d>0?X/d-1:0,$.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);
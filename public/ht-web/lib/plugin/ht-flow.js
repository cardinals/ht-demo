!function(E){"use strict";var u=E.ht,F=u.Default,l=F.getInternal(),A=l.ui(),C=null,T="__segmentLengths",K="__lineTotalLength",N="__linePoints",R="__distance0",s="flow.count",m="flow.step",Y="flow.element.max",p="flow.element.count",$="flow.element.min",V="flow.element.space",W="flow.element.autorotate",x="flow.element.background",I="flow.element.shadow.max",n="flow.element.shadow.min",Q="flow.element.shadow.begincolor",D="flow.element.shadow.endcolor",c="flow.element.shadow.visible",v="flow.element.image",X="flow",j=u.Math.Vector2,H=new j;new j,new j,u.List;var O=u.Default._edgeProtectMethod,J=O.getStraightLinePoints,o=function(d,C){for(var I=[],r=d.length,M=0;r>M;M++){var j=d[M];j._as&&(j=j._as);for(var K=j[0],G=1;G<j.length;G++)I.push([K,j[G]]),K=j[G]}for(var i=[],M=0;M<I.length;M++){var L=f(I[M][0],I[M][1],C);i.push(L)}return{distance:i,segments:I}},r=function(C,$,x){if(C){for(var n,P=o(C,$),A=P.distance,S=P.segments,B=1/0,q=null,t=0,R=A.length;R>t;t++){var p=A[t];p.z<B&&(n=t,B=p.z,q=p)}if(null==x&&(x=.1),q.z<x){for(var Z=0,G=0;n>=G;G++)Z+=F.getDistance(S[G][0],n>G?S[G][1]:q);return Z}}},f=function(m,A,l){var O=m.x,Y=m.y,Q=A.x,p=A.y,q=l.x,U=l.y,B=Q-O,E=p-Y,h=Math.sqrt(B*B+E*E),o=B/h,v=E/h,g=(-O+q)*o+(-Y+U)*v,i={x:O+g*o,y:Y+g*v};return i.x>=Math.min(m.x,A.x)&&i.x<=Math.max(m.x,A.x)&&i.y>=Math.min(m.y,A.y)&&i.y<=Math.max(m.y,A.y)||(i.x=Math.abs(i.x-m.x)<Math.abs(i.x-A.x)?m.x:A.x,i.y=Math.abs(i.y-m.y)<Math.abs(i.y-A.y)?m.y:A.y),B=q-i.x,E=U-i.y,i.z=Math.sqrt(B*B+E*E),i},t=function(p,y){if(p){var f=o(p,y).distance,L=1/0,q=null;return f.forEach(function(B){B.z<L&&(L=B.z,q=B)}),q}},b=O.calculateLineLength,S=O.calcSegmentIndexByDistance,h=O.calculatePointAlongLine,B=function(m,l,a){if(!m)return a;if(0===l){var r=m[0][0],T=m[0][1];return a+Math.atan2(T.y-r.y,T.x-r.x)}if(100===l){m=m[m.length-1];var r=m[m.length-2],T=m[m.length-1];return a+Math.atan2(T.y-r.y,T.x-r.x)}for(var _=0,d=[],A=m.length,G=0;A>G;G++){var f=m[G],z=b(f);_+=z,d.push(z)}for(var E=_*l/100,o=S(E,d),N=0,F=0;o>F;F++)N+=d[F];E-=N;for(var Z=h(m[o],E),U=m[o],X=0,R=0,L=0;L<U.length-1;L++){var t=U[L],s=U[L+1],Y=s.x-t.x,B=s.y-t.y,u=Math.sqrt(Y*Y+B*B);if(X+=u,X>E){R=L;break}}var D=U[R];return a+Math.atan2(Z.y-D.y,Z.x-D.x)},d=function(K){var v=0;if(K)if(Array.isArray(K[0]))for(var B=K.length,J=0;B>J;J++){var N=K[J],U=b(N);v+=U}else v=b(K);return v},M=function(m,y,J,g){return H.set(y,J).rotateAround(null,g),m?{x:m.x+H.x,y:m.y+H.y}:{x:H.x,y:H.y}},g=function(A){var c=A._data,m=J(A);if(m){c.s("flow.reverse")&&(m.reverse(),m.forEach(function(M){M.reverse()}));for(var g=0,l=[],V=m.length,X=0;V>X;X++){var f=m[X],E=b(f);g+=E,l.push(E)}if(c[T]=l,c[K]=g,c[N]=m,c instanceof u.Edge){var j=F.unionPoint(m),h=j.x+j.width/2,Q=j.y+j.height/2;c.$10e={x:h,y:Q}}U(A,!0)}},z=O.getPercentPosition,U=function(k,U){var X=k._data,C=X[K],A=X.s(s),z=X.s(m),e=0,I=X[T],w=X.s(Y),D=X.s($),Z=X.s(p),q=(w-D)/(Z-1),J=[];if(I){if(1===Z)J.push(w);else if(2===Z)J.push(w),J.push(D);else{if(!(Z>2))return;J.push(w);for(var M=Z-2;M>0;M--)J.push(D+q*M);J.push(D)}var G=0,F=0;J.forEach(function(u){Z-1>G&&(F+=X.getFlowElementSpace(u)),G++}),F+=(w+D)/2,e=(C-A*F+F)/A;var v=k[R];for(null==v&&(v=0),U||(v+=z);v>C+F;){var V=k._overCount;V?V++:V=1,V>=A&&(V=null),k._overCount=V,X.s("flow.autoreverse")?V?v-=e+F:(v=0,X.s("flow.reverse",!X.s("flow.reverse"))):v-=e+F}k[R]=v}},G="prototype",k=u.graph.GraphView[G],Z=u.Data[G],e=A.DataUI[G],P=A.ShapeUI[G],w=A.EdgeUI[G],y=u.DataModel[G],a=u.Style;a[Y]==C&&(a[Y]=7),a[$]==C&&(a[$]=0),a[s]==C&&(a[s]=1),a[m]==C&&(a[m]=3),a[p]==C&&(a[p]=10),a[V]==C&&(a[V]=3.5),a[W]==C&&(a[W]=!1),a[x]==C&&(a[x]="rgba(255, 255, 114, 0.4)"),a[Q]==C&&(a[Q]="rgba(255, 255, 0, 0.3)"),a[D]==C&&(a[D]="rgba(255, 255, 0, 0)"),a[c]==C&&(a[c]=1),a[I]==C&&(a[I]=22),a[n]==C&&(a[n]=4),k.calculatePointLength=function(w,o,Y){var x=this.getDataUI(w),f=J(x);return r(f,o,Y)},F.calculatePointLength=function(Q,D,v,e){var W=J(C,Q,D);return r(W,v,e)},F.calculateClosestPointOnLine=f,k.calculateClosestPoint=function(D,$){var d=this.getDataUI(D),Q=J(d);return t(Q,$)},F.calculateClosestPoint=function(D,E,_){var A=J(C,D,E);return t(A,_)},k.getPercentAngle=function(T,I){var S=this.getDataUI(T),g=J(S);return T.getRotation?T.getRotation():0,B(g,I,T.getRotation?T.getRotation():0)},F.getPercentAngle=function(g,T,h){var f=J(C,g,T);return B(f,h,0)},k.calculateLength=function(Y){var C=this.getDataUI(Y),G=J(C);return d(G)},F.calculateLength=function(k,T){var v=J(C,k,T);return d(v)},k.getPercentPosition=function(v,s){var r=this.getDataUI(v),F=J(r);return z(F,s)},F.getPercentPositionOnPoints=function($,B,W){var R=J(C,$,B);return z(R,W)};var q=function(U){var h=U.data,k=this.dm();if(h&&"add"===U.kind){var r=k.$3e;r&&h.s(X)&&r.indexOf(h)<0&&r.push(h)}"clear"===U.kind&&(k.$3e=[])},L=function(y){var i=y.property,d=y.data,M=y.newValue,o=this.dm().$3e;if(o&&"s:flow"===i)if(M)o.indexOf(d)<0&&o.push(d);else for(var V=o.length,s=0;V>s;s++)if(o[s]===d){o.splice(s,1);break}},_=k.setDataModel;k.setDataModel=function($){var G=this,t=G._dataModel;if(t!==$){t&&(t.umm(q,G),t.umd(L,G),t.$3e=[]),$.mm(q,G),$.md(L,G);var N=$.$3e=[];$.each(function(z){z.s(X)&&N.indexOf(z)<0&&N.push(z)}),_.call(G,$)}},Z.getFlowElementSpace=function(){return this.s(V)};var i=function(U){var Z=this,t=Z._data,w=t[K],O=t[T],g=t[N],L=t.s(s),o=0,X=Z[R],k=t.s(Y),v=t.s($),P=t.s(p),_=t.s(n),u=t.s(I),E=t.s(W),V=(u-_)/(P-1),J=(k-v)/(P-1),a=t.getRotation?t.getRotation():0,B=t.getPosition?t.p():t.$10e,z=[],A=[];if(X!=C){if(1===P)z.push(k);else if(2===P)z.push(k),z.push(v);else{if(!(P>2))return;z.push(k);for(var D=P-2;D>0;D--)z.push(v+J*D);z.push(v)}if(1===P)A.push(u);else if(2===P)A.push(u),A.push(_);else{if(!(P>2))return;A.push(u);for(var D=P-2;D>0;D--)A.push(_+V*D);A.push(_)}var c=0,d=0;z.forEach(function(g){P-1>c&&(d+=t.getFlowElementSpace(g)),c++}),d+=(k+v)/2,o=(w-L*d+d)/L,U.save();for(var D=0;L>D;D++){var F=X,q=0,f=Z._overCount,i=0;t.s("flow.autoreverse")&&f&&f>L-(D+1)||(F-=D*(o+d),c=0,z.forEach(function(V){var Y=F-q;if(Y>=0&&w>Y){var v=!0,m=S(Y,O);i=0;for(var N=0;m>N;N++)i+=O[N];if(Y-=i,v){var H=h(g[m],Y),W=a;if(E){for(var R=g[m],X=0,I=0,j=0;j<R.length-1;j++){var l=R[j],C=R[j+1],e=C.x-l.x,u=C.y-l.y,p=Math.sqrt(e*e+u*u);if(X+=p,X>Y){I=j;break}}var K=R[I];W+=Math.atan2(H.y-K.y,H.x-K.x)}a&&(H=M(B,H.x-B.x,H.y-B.y,a)),Z.$5e(U,H,V,A[c],W)}}q+=t.getFlowElementSpace(z[c]),c++}))}U.restore()}},kg=w._80o;w._80o=function(k){kg.call(this,k);var Z=this,S=Z._data,n=Z.gv;S.s(X)&&n.$7e!=C&&i.call(Z,k)};var mc=P._80o;P._80o=function(J){mc.call(this,J);var y=this,I=y._data,z=y.gv;I.s(X)&&z.$7e!=C&&i.call(y,J)};var Te=w._79o,Xq=P._79o,fm=function(){var s=this,e=s._data,k=e.s(Y),x=!1,S=C;if(s._6I||(x=!0),S=e instanceof u.Edge?Te.call(s):Xq.call(s),e.s(X)&&x){var l=e.s(I),E=e.s(c);E&&l>k&&(k=l),k>0&&F.grow(S,Math.ceil(k/2)),g(s)}return!e.s(X)&&x&&(e[T]=e[K]=e[N]=s[R]=C),S};P._79o=fm,w._79o=fm,e.$5e=function(w,S,G,$,n){var U=this,m=U._data,b=U.gv,W=m.s(x),K=m.s(Q),k=m.s(D),N=m.s(c),O=b.$8e,d=m.s(v);if(O==C&&(O=b.$8e={}),w.beginPath(),d!=C){var r=F.getImage(d),h=G/2;w.translate(S.x,S.y),w.rotate(n),w.translate(-S.x,-S.y),F.drawImage(w,r,S.x-h,S.y-h,G,G,m),w.translate(S.x,S.y),w.rotate(-n),w.translate(-S.x,-S.y)}else if(b.__flowBatch){var M=b.__flowBatchGroup;M||(M=b.__flowBatchGroup={});var Y=[S.x,S.y,G/2];M[W]?M[W].push(Y):M[W]=[Y]}else w.fillStyle=W,w.arc(S.x,S.y,G/2,0,2*Math.PI,!0),w.fill();if(N){var u=22,e=u+"_"+K+"_"+k,B=O[e];if(B==C){var T=document.createElement("canvas");l.setCanvas(T,u,u);var Z=T.getContext("2d"),i=u/2,s=i,j=i;l.translateAndScale(Z,0,0,1),Z.beginPath();var X=Z.createRadialGradient(s,j,0,s,s,i);X.addColorStop(0,K),X.addColorStop(1,k),Z.fillStyle=X,Z.arc(s,j,i,0,2*Math.PI,!0),Z.fill(),B=O[e]=T}var h=$/2;F.drawImage(w,B,S.x-h,S.y-h,$,$,m)}},k.$9e=function(){var L=this,Z=L.dm().$3e;L._24I,Z.forEach(function(Y){L._24I[Y._id]=Y}),L.iv()};var ds=y.prepareRemove;y.prepareRemove=function(B){ds.call(this,B);var i=B._dataModel,R=i.$3e;if(R)for(var W=R.length,r=0;W>r;r++)if(R[r]===B){R.splice(r,1);break}},k.setFlowInterval=function(O){var $=this,P=$.$11e;$.$11e=O,$.fp("flowInterval",P,O),$.$7e!=C&&(clearInterval($.$7e),delete $.$7e,$.enableFlow(O))},k.getFlowInterval=function(){return this.$11e},k.enableFlow=function(r){var G=this,$=G.dm(),M=$.$3e;G.$7e==C&&(M.forEach(function(Q){var I=G.getDataUI(Q);g(I)}),G.$7e=setInterval(function(){$.$3e.forEach(function(a){U(G.getDataUI(a))}),G.$9e()},r||G.$11e||50))},k.disableFlow=function(){var J=this;clearInterval(J.$7e),delete J.$7e;var c=J.dm().$3e;c&&J.$9e()};var fp=function(){this.__flowBatchGroup={}},Jc=function(R){var T=this.__flowBatchGroup;if(T){R.save();for(var y in T){R.fillStyle=y,R.beginPath();var M=T[y];M.forEach(function(F){R.moveTo(F[0],F[1]),R.arc(F[0],F[1],F[2],0,2*Math.PI,!0)}),R.fill()}R.restore()}};k.setFlowBatch=function(A){var H=this;!!H.__flowBatch!=!!A&&(H.__flowBatch=A,A?(H.addBottomPainter(fp),H.addTopPainter(Jc)):(H.removeBottomPainter(fp),H.removeTopPainter(Jc)))}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);